<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fishing Knots 101 - Complete Guide to Essential Fishing Knots</title>
    <meta name="description" content="Learn the most important fishing knots with step-by-step video tutorials. Master clinch knots, FG knots, surgeon's knots, and more essential fishing techniques." />
    <meta name="keywords" content="fishing knots, clinch knot, FG knot, surgeon's knot, alberto knot, palomar knot, fishing tutorials, angling, fishing techniques" />
    <meta name="author" content="Fishing Knots 101" />

    <!-- Open Graph tags for social sharing -->
    <meta property="og:title" content="Fishing Knots 101 - Complete Guide to Essential Fishing Knots" />
    <meta property="og:description" content="Learn the most important fishing knots with step-by-step video tutorials." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://fishingknots101.com" />

    <!-- Twitter Card tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Fishing Knots 101 - Complete Guide to Essential Fishing Knots" />
    <meta name="twitter:description" content="Learn the most important fishing knots with step-by-step video tutorials." />

    <!-- Canonical URL -->
    <link rel="canonical" href="https://fishingknots101.com" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Fishing Knots 101",
      "description": "Complete guide to essential fishing knots with video tutorials",
      "url": "https://fishingknots101.com",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://fishingknots101.com/search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-900 text-white shadow-lg">
      <div class="container mx-auto px-4 py-6">
        <div class="flex items-center justify-between">
          <h1 class="text-3xl md:text-4xl font-bold">
            Fishing Knots 101
          </h1>

          <!-- Search Button -->
          <button
            id="openSearchModal"
            class="bg-blue-700 hover:bg-blue-600 text-white px-3 sm:px-6 py-2 rounded-lg transition-colors flex items-center gap-2"
          >
            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="hidden sm:inline">Search</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">


      <!-- Knots Grid -->
      <div class="mb-4">
        <div class="flex flex-wrap items-center gap-4">
          <p id="knotCount" class="text-gray-600 text-sm"></p>
          <div id="activeFilters" class="flex flex-wrap gap-2"></div>
        </div>
      </div>

      <div id="knotsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- Knots will be dynamically inserted here -->
      </div>

      <!-- No Results Message -->
      <div id="noResults" class="hidden text-center py-12">
        <div class="text-gray-400 text-6xl mb-4">ðŸŽ£</div>
        <h3 class="text-xl font-semibold text-gray-600 mb-2">No knots found</h3>
        <p class="text-gray-500">Try adjusting your search or filters</p>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-16">
      <div class="container mx-auto px-4 py-8">
        <div class="text-center">
          <h3 class="text-xl font-semibold mb-4">Fishing Knots 101</h3>
          <p class="text-gray-400 mb-4">
            Your comprehensive guide to mastering essential fishing knots
          </p>
        </div>
      </div>
    </footer>

    <!-- Modal -->
    <div id="knotModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-auto">
        <div class="flex justify-between items-center p-6 border-b">
          <h2 id="modalTitle" class="text-2xl font-bold text-gray-800"></h2>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">
            &times;
          </button>
        </div>

        <div class="p-6">
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Knot Details -->
            <div class="lg:col-span-1">
              <div class="space-y-4">
                <div>
                  <h3 class="font-semibold text-gray-700 mb-2">Difficulty</h3>
                  <span id="modalDifficulty" class="inline-block px-3 py-1 rounded-full text-sm font-medium"></span>
                </div>

                <div>
                  <h3 class="font-semibold text-gray-700 mb-2">Strength</h3>
                  <span id="modalStrength" class="inline-block px-3 py-1 rounded-full text-sm font-medium"></span>
                </div>

                <div>
                  <h3 class="font-semibold text-gray-700 mb-2">Best Used For</h3>
                  <div id="modalTags" class="flex flex-wrap gap-2"></div>
                </div>

                <div>
                  <h3 class="font-semibold text-gray-700 mb-2">Description</h3>
                  <p id="modalDescription" class="text-gray-600 text-sm leading-relaxed"></p>
                </div>
              </div>
            </div>

            <!-- Video Player -->
            <div class="lg:col-span-2">
              <div class="aspect-video">
                <iframe
                  id="modalVideo"
                  width="100%"
                  height="100%"
                  src=""
                  title="Fishing Knot Tutorial"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen
                  class="rounded-lg"
                ></iframe>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Search Modal -->
    <div id="searchModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-auto">
        <div class="flex justify-between items-center p-6 border-b">
          <h2 class="text-2xl font-bold text-gray-800">Search Knots</h2>
          <button id="closeSearchModal" class="text-gray-500 hover:text-gray-700 text-3xl font-bold">
            &times;
          </button>
        </div>

        <div class="p-6">
          <div class="space-y-6">
            <!-- Search Input -->
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
              <div class="relative">
                <input
                  type="text"
                  id="searchInput"
                  placeholder="Search knots, tags, or difficulty..."
                  class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
                <svg class="absolute right-3 top-2.5 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
              </div>
            </div>

            <!-- Filters -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Difficulty</label>
                <select id="modalDifficultyFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">All Difficulties</option>
                  <option value="Easy">Easy</option>
                  <option value="Medium">Medium</option>
                  <option value="Hard">Hard</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Strength</label>
                <select id="modalStrengthFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">All Strengths</option>
                  <option value="High">High</option>
                  <option value="Medium">Medium</option>
                  <option value="Low">Low</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Use Case</label>
                <select id="modalTagFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="">All Use Cases</option>
                  <option value="hook">Hook Attachment</option>
                  <option value="line-to-line">Line to Line</option>
                  <option value="loop">Loop Formation</option>
                  <option value="swivel">Swivel Connection</option>
                  <option value="braid-to-mono">Braid to Mono</option>
                  <option value="braid-to-fluoro">Braid to Fluoro</option>
                  <option value="leader">Leader Connection</option>
                </select>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 pt-4">
              <button id="performSearch" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                Search
              </button>
              <button id="cancelSearch" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 transition-colors">
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Fishing Knots Data Structure
      const fishingKnots = [
        {
          id: 1,
          name: "Improved Clinch Knot",
          difficulty: "Easy",
          strength: "Medium",
          tags: ["hook", "lure", "swivel", "beginner-friendly"],
          description: "The most popular knot for tying line to hook, lure or swivel. Easy to tie and reliable for most fishing situations.",
          videoId: "6QbJfpsGpmM"
        },
        {
          id: 2,
          name: "FG Knot",
          difficulty: "Hard",
          strength: "High",
          tags: ["braid-to-fluoro", "braid-to-mono", "leader", "line-to-line"],
          description: "Very strong leader knot that joins braided line to fluorocarbon or monofilament leader. Preferred by many professional anglers.",
          videoId: "ZPTzkep9xlI",
          time: 60
        },
        {
          id: 3,
          name: "Surgeon's Knot",
          difficulty: "Easy",
          strength: "High",
          tags: ["line-to-line", "leader", "quick-tie"],
          description: "Easy knot to join two lines of moderately unequal size. Quick to tie and very reliable.",
          videoId: "Tmz25DTGgnk"
        },
        {
          id: 4,
          name: "Alberto Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["braid-to-fluoro", "braid-to-mono", "leader", "line-to-line"],
          description: "Excellent knot for connecting braided line to fluorocarbon or monofilament leader. Easier to tie than the FG knot.",
          videoId: "zrVzp0n2gAw"
        },
        {
          id: 5,
          name: "Palomar Knot",
          difficulty: "Easy",
          strength: "High",
          tags: ["hook", "lure", "braid", "strong"],
          description: "Best knot for attaching braided line to a hook. Very strong and maintains most of the line's original strength.",
          videoId: "uWw_f7CQQLg"
        },
        {
          id: 6,
          name: "Uni Knot",
          difficulty: "Easy",
          strength: "Medium",
          tags: ["hook", "lure", "swivel", "versatile"],
          description: "Versatile knot that can be used for hooks, lures, and swivels. Easy to tie and adjust.",
          videoId: "f1pFMWc0ZP0"
        },
        {
          id: 7,
          name: "Blood Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["line-to-line", "similar-diameter", "fly-fishing"],
          description: "One of the best knots for joining two lines of similar diameter. Popular in fly fishing.",
          videoId: "__OX3jK62Fo"
        },
        {
          id: 8,
          name: "Double Uni Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["braid-to-mono", "braid-to-fluoro", "line-to-line", "reliable"],
          description: "Reliable knot for connecting braided line to monofilament or fluorocarbon. Good alternative to the FG knot.",
          videoId: "6VgQLBpwJUY"
        },
        {
          id: 9,
          name: "Rapala Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["lure", "hook", "loop", "action-preserving"],
          description: "A non-slip loop knot that allows lures to move more freely, enhancing their action in the water.",
          videoId: "rc55L3AHA0s"
        },
        {
          id: 10,
          name: "Albright Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["line-to-line", "different-diameter", "leader"],
          description: "Used to join different types or thicknesses of fishing line. Great for connecting heavy leader to lighter main line.",
          videoId: "eKYZL9ETWk4"
        },
        {
          id: 11,
          name: "Perfection Loop",
          difficulty: "Medium",
          strength: "High",
          tags: ["loop", "fly-fishing", "leader"],
          description: "Creates a small, strong loop at the end of a line. Perfect for loop-to-loop connections.",
          videoId: "nyzAbhq-Oxc"
        },
        {
          id: 12,
          name: "Trilene Knot",
          difficulty: "Easy",
          strength: "High",
          tags: ["hook", "mono", "strong"],
          description: "Strong knot for joining monofilament line to hooks. Passes through the hook eye twice for extra security.",
          videoId: "cC93iQWUJUY"
        },
        {
          id: 13,
          name: "Bimini Twist",
          difficulty: "Hard",
          strength: "High",
          tags: ["double-line", "loop", "offshore", "leader"],
          description: "Creates a strong double-line leader and is excellent for loop-to-loop connections. Popular in offshore fishing.",
          videoId: "jahddqzKhLY"
        },
        {
          id: 14,
          name: "Snell Knot",
          difficulty: "Medium",
          strength: "High",
          tags: ["hook", "leader", "direct-tie"],
          description: "Allows leader or tippet to be tied directly to a hook. Provides excellent hook-setting power.",
          videoId: "-_ftAGkewfE"
        },
        {
          id: 15,
          name: "Haywire Twist",
          difficulty: "Medium",
          strength: "High",
          tags: ["wire", "leader", "offshore", "toothy-fish"],
          description: "Provides a strong connection for wire leader to hook or swivel. Essential for fish with sharp teeth.",
          videoId: "3J5yuXW4uR0"
        },
        {
          id: 16,
          name: "Dropper Loop",
          difficulty: "Medium",
          strength: "Medium",
          tags: ["loop", "multiple-hooks", "bottom-fishing"],
          description: "Creates a loop anywhere along the fishing line, perfect for attaching additional hooks or weights.",
          videoId: "HYvd6F-MnzQ"
        },
        {
          id: 17,
          name: "Nail Knot",
          difficulty: "Hard",
          strength: "High",
          tags: ["fly-fishing", "line-to-line", "leader"],
          description: "Used to join two lines of different diameters. Popular in fly fishing for attaching leader to fly line.",
          videoId: "D5U3E8590vA"
        },
        {
          id: 18,
          name: "Arbor Knot",
          difficulty: "Easy",
          strength: "Low",
          tags: ["reel", "backing", "spool"],
          description: "Used to attach your fishing line to the reel spool center. Simple and effective for this specific purpose.",
          videoId: "IcoAF_jspGo"
        },
        {
          id: 19,
          name: "Loop to Loop Connection",
          difficulty: "Easy",
          strength: "High",
          tags: ["loop", "connection", "quick-change"],
          description: "Method of joining two loops together. Allows for quick leader changes and strong connections.",
          videoId: "L3YBTzr5iDI"
        },
        {
          id: 20,
          name: "Orvis Knot",
          difficulty: "Easy",
          strength: "High",
          tags: ["hook", "fly-fishing", "small", "strong"],
          description: "Small yet very strong knot to attach a hook to a line. Popular in fly fishing applications.",
          videoId: "E9W4BmrPUXA"
        }
      ];

      // DOM Elements
      const openSearchModalBtn = document.getElementById('openSearchModal');
      const searchModal = document.getElementById('searchModal');
      const closeSearchModalBtn = document.getElementById('closeSearchModal');
      const searchInput = document.getElementById('searchInput');
      const difficultyFilter = document.getElementById('modalDifficultyFilter');
      const strengthFilter = document.getElementById('modalStrengthFilter');
      const tagFilter = document.getElementById('modalTagFilter');
      const performSearchBtn = document.getElementById('performSearch');
      const cancelSearchBtn = document.getElementById('cancelSearch');
      const knotsContainer = document.getElementById('knotsContainer');
      const knotCount = document.getElementById('knotCount');
      const activeFilters = document.getElementById('activeFilters');
      const noResults = document.getElementById('noResults');
      const modal = document.getElementById('knotModal');
      const closeModal = document.getElementById('closeModal');

      // State
      let filteredKnots = [...fishingKnots];

      // Utility Functions
      function getDifficultyColor(difficulty) {
        switch(difficulty) {
          case 'Easy': return 'bg-green-100 text-green-800';
          case 'Medium': return 'bg-yellow-100 text-yellow-800';
          case 'Hard': return 'bg-red-100 text-red-800';
          default: return 'bg-gray-100 text-gray-800';
        }
      }

      function getStrengthColor(strength) {
        switch(strength) {
          case 'High': return 'bg-green-100 text-green-800';
          case 'Medium': return 'bg-yellow-100 text-yellow-800';
          case 'Low': return 'bg-red-100 text-red-800';
          default: return 'bg-gray-100 text-gray-800';
        }
      }

      function getTagDisplay(tag) {
        const tagMap = {
          'hook': 'Hook Attachment',
          'lure': 'Lure Connection',
          'swivel': 'Swivel Connection',
          'line-to-line': 'Line to Line',
          'loop': 'Loop Formation',
          'braid-to-mono': 'Braid to Mono',
          'braid-to-fluoro': 'Braid to Fluoro',
          'leader': 'Leader Connection',
          'beginner-friendly': 'Beginner Friendly',
          'versatile': 'Versatile',
          'strong': 'High Strength',
          'quick-tie': 'Quick to Tie',
          'fly-fishing': 'Fly Fishing',
          'similar-diameter': 'Similar Diameter',
          'reliable': 'Reliable',
          'action-preserving': 'Preserves Action',
          'different-diameter': 'Different Diameter',
          'double-line': 'Double Line',
          'offshore': 'Offshore Fishing',
          'direct-tie': 'Direct Tie',
          'wire': 'Wire Leader',
          'toothy-fish': 'Toothy Fish',
          'multiple-hooks': 'Multiple Hooks',
          'bottom-fishing': 'Bottom Fishing',
          'reel': 'Reel Attachment',
          'backing': 'Backing Line',
          'spool': 'Spool Connection',
          'connection': 'Connection',
          'quick-change': 'Quick Change',
          'small': 'Compact',
          'mono': 'Monofilament',
          'braid': 'Braided Line'
        };
        return tagMap[tag] || tag;
      }

      // Filter Management Functions
      function renderActiveFilters() {
        const filters = [];

        if (searchInput.value.trim()) {
          filters.push({
            type: 'search',
            label: `Search: "${searchInput.value}"`,
            value: searchInput.value
          });
        }

        if (difficultyFilter.value) {
          filters.push({
            type: 'difficulty',
            label: `Difficulty: ${difficultyFilter.value}`,
            value: difficultyFilter.value
          });
        }

        if (strengthFilter.value) {
          filters.push({
            type: 'strength',
            label: `Strength: ${strengthFilter.value}`,
            value: strengthFilter.value
          });
        }

        if (tagFilter.value) {
          const tagText = tagFilter.options[tagFilter.selectedIndex].text;
          filters.push({
            type: 'tag',
            label: `Use Case: ${tagText}`,
            value: tagFilter.value
          });
        }

        if (filters.length === 0) {
          activeFilters.innerHTML = '';
          return;
        }

        activeFilters.innerHTML = filters.map(filter => `
          <span class="inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
            ${filter.label}
            <button
              onclick="removeFilter('${filter.type}')"
              class="ml-1 hover:bg-blue-200 rounded-full p-0.5 transition-colors"
              title="Remove filter"
            >
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </span>
        `).join('');
      }

      function removeFilter(filterType) {
        switch(filterType) {
          case 'search':
            searchInput.value = '';
            break;
          case 'difficulty':
            difficultyFilter.value = '';
            break;
          case 'strength':
            strengthFilter.value = '';
            break;
          case 'tag':
            tagFilter.value = '';
            break;
        }

        filterKnots();
      }

      // Render Functions
      function renderKnot(knot) {
        return `
          <div class="bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer knot-card" data-knot-id="${knot.id}">
            <div class="p-6">
              <h3 class="text-lg font-semibold text-gray-800 mb-3">${knot.name}</h3>

              <div class="space-y-3 mb-4">
                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Difficulty:</span>
                  <span class="px-2 py-1 rounded-full text-xs font-medium ${getDifficultyColor(knot.difficulty)}">
                    ${knot.difficulty}
                  </span>
                </div>

                <div class="flex items-center justify-between">
                  <span class="text-sm text-gray-600">Strength:</span>
                  <span class="px-2 py-1 rounded-full text-xs font-medium ${getStrengthColor(knot.strength)}">
                    ${knot.strength}
                  </span>
                </div>
              </div>

              <div class="mb-4">
                <p class="text-sm text-gray-600 line-clamp-3">${knot.description}</p>
              </div>

              <div class="flex flex-wrap gap-1 mb-4">
                ${knot.tags.slice(0, 3).map(tag =>
                  `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${getTagDisplay(tag)}</span>`
                ).join('')}
                ${knot.tags.length > 3 ? `<span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full">+${knot.tags.length - 3}</span>` : ''}
              </div>

              <button class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2 cursor-pointer">
                Watch Tutorial
              </button>
            </div>
          </div>
        `;
      }

      function renderKnots() {
        if (filteredKnots.length === 0) {
          knotsContainer.innerHTML = '';
          knotCount.textContent = '';
          noResults.classList.remove('hidden');
          renderActiveFilters();
          return;
        }

        noResults.classList.add('hidden');
        knotCount.textContent = `Showing ${filteredKnots.length} of ${fishingKnots.length} knots`;
        knotsContainer.innerHTML = filteredKnots.map(renderKnot).join('');
        renderActiveFilters();

        // Add click event listeners to knot cards
        document.querySelectorAll('.knot-card').forEach(card => {
          card.addEventListener('click', () => {
            const knotId = parseInt(card.dataset.knotId);
            const knot = fishingKnots.find(k => k.id === knotId);
            openModal(knot);
          });
        });
      }

      // Modal Functions
      function openModal(knot, updateHash = true) {
        document.getElementById('modalTitle').textContent = knot.name;
        document.getElementById('modalDifficulty').textContent = knot.difficulty;
        document.getElementById('modalDifficulty').className = `inline-block px-3 py-1 rounded-full text-sm font-medium ${getDifficultyColor(knot.difficulty)}`;

        document.getElementById('modalStrength').textContent = knot.strength;
        document.getElementById('modalStrength').className = `inline-block px-3 py-1 rounded-full text-sm font-medium ${getStrengthColor(knot.strength)}`;

        document.getElementById('modalTags').innerHTML = knot.tags.map(tag =>
          `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${getTagDisplay(tag)}</span>`
        ).join('');

        document.getElementById('modalDescription').textContent = knot.description;

        // Set YouTube embed URL
        const videoUrl = `https://www.youtube.com/embed/${knot.videoId}?autoplay=1&rel=0&t=${knot.time ?? 0}`;
        console.log(videoUrl);
        document.getElementById('modalVideo').src = videoUrl;

        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';

        // Update URL hash
        if (updateHash) {
          window.history.pushState(null, null, `#${slugify(knot.name)}`);
        }
      }

      function closeModalFunction(updateHash = true) {
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
        // Stop video playback
        document.getElementById('modalVideo').src = '';

        // Update URL hash
        if (updateHash) {
          window.history.pushState(null, null, window.location.pathname);
        }
      }

      // URL Hash Functions
      function slugify(text) {
        return text
          .toLowerCase()
          .replace(/[^\w\s-]/g, '') // Remove special characters except hyphens
          .replace(/\s+/g, '-')     // Replace spaces with hyphens
          .replace(/--+/g, '-')     // Replace multiple hyphens with single hyphen
          .trim();
      }

      function getKnotFromHash() {
        const hash = window.location.hash;
        if (hash.startsWith('#')) {
          const knotSlug = hash.replace('#', '');
          return fishingKnots.find(k => slugify(k.name) === knotSlug);
        }
        return null;
      }

      function handleHashChange() {
        const knot = getKnotFromHash();
        if (knot) {
          openModal(knot, false);
        } else {
          closeModalFunction(false);
        }
      }

      // Filter Functions
      function filterKnots() {
        const searchTerm = searchInput.value.toLowerCase();
        const difficultyValue = difficultyFilter.value;
        const strengthValue = strengthFilter.value;
        const tagValue = tagFilter.value;

        filteredKnots = fishingKnots.filter(knot => {
          const matchesSearch = !searchTerm ||
            knot.name.toLowerCase().includes(searchTerm) ||
            knot.description.toLowerCase().includes(searchTerm) ||
            knot.tags.some(tag => getTagDisplay(tag).toLowerCase().includes(searchTerm)) ||
            knot.difficulty.toLowerCase().includes(searchTerm) ||
            knot.strength.toLowerCase().includes(searchTerm);

          const matchesDifficulty = !difficultyValue || knot.difficulty === difficultyValue;
          const matchesStrength = !strengthValue || knot.strength === strengthValue;
          const matchesTag = !tagValue || knot.tags.includes(tagValue);

          return matchesSearch && matchesDifficulty && matchesStrength && matchesTag;
        });

        renderKnots();
      }

      function clearFilters() {
        searchInput.value = '';
        difficultyFilter.value = '';
        strengthFilter.value = '';
        tagFilter.value = '';
        filteredKnots = [...fishingKnots];
        renderKnots();
      }

      // Search Modal Functions
      function openSearchModal() {
        searchModal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        // Focus on search input when modal opens
        setTimeout(() => searchInput.focus(), 100);
      }

      function closeSearchModal() {
        searchModal.classList.add('hidden');
        document.body.style.overflow = 'auto';
      }

      // Event Listeners
      openSearchModalBtn.addEventListener('click', openSearchModal);
      closeSearchModalBtn.addEventListener('click', closeSearchModal);
      performSearchBtn.addEventListener('click', () => {
        filterKnots();
        closeSearchModal();
      });
      cancelSearchBtn.addEventListener('click', closeSearchModal);
      closeModal.addEventListener('click', closeModalFunction);

      // Allow Enter key to perform search in modal
      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          filterKnots();
          closeSearchModal();
        }
      });

      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          closeModalFunction();
        }
      });

      // Close search modal when clicking outside
      searchModal.addEventListener('click', (e) => {
        if (e.target === searchModal) {
          closeSearchModal();
        }
      });

      // Close modals with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          if (!modal.classList.contains('hidden')) {
            closeModalFunction();
          } else if (!searchModal.classList.contains('hidden')) {
            closeSearchModal();
          }
        }
      });

      // Handle hash changes for browser navigation
      window.addEventListener('hashchange', handleHashChange);
      window.addEventListener('popstate', handleHashChange);

      // Initialize
      renderKnots();

      // Check for hash on page load and open modal if needed
      function initializeFromHash() {
        const knot = getKnotFromHash();
        if (knot) {
          openModal(knot, false);
        }
      }

      // Since script is at bottom of body, DOM should be ready
      initializeFromHash();

      // Add some CSS for line clamping
      const style = document.createElement('style');
      style.textContent = `
        .line-clamp-3 {
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
          overflow: hidden;
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
